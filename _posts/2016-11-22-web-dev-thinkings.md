---
layout: post
title: 关于Web开发的一些思考：工具，配置，最佳实践
category: Web开发
tags: [ 'web', 'programming' ]
---

前几天写完了毕业论文，交给老板等着修改意见。趁着这几天没什么事情又爬进了Web开发的坑，看了好多“Get Started”和“Tutorial”， 研究了最“bleeding edge”的开发工具和框架，试着自己写了几个小网站感受这些工具的力量，收获了一些思考在此分享。

先列举一下涉及到的东西吧：

  * Gulp
  * Webpack
  * React
  * Redux
  * Pug
  * Stylus
  * Babel

## 如果可以选择，我们应该使用那些工具和框架？

抛开加入一个成熟的团队，被迫使用已有框架的情况不谈，如果我们有机会负责一个全新的Web项目，整个项目的框架都由自己决定时，选择什么工具将会成为一个至关重要的问题。对于Web开发来说，最不缺的就是现成的轮子，所以这个问题对于选择恐惧症患者来说就尤为困难。网上有无数工具可以供我们使用，安装也基本都是简单的一句`npm install`，每个工具都说自己解决了一个头疼的问题，每个问题都有好几种工具可供我们使用。在这样的环境下，我们到底该如何选择呢？

### 我们是否需要某一种工具？

在选择工具之前，我们应该先思考：我们真的需要一个额外的包来解决某个问题吗？比如当你纠结于Gulp还是Grunt时（虽然现在基本都会选择Gulp了），你应该先问问自己：我真的需要一个自动化构建工具吗？当你纠结于用pug还是markdown时，你应该先问问自己：我真的需要一个模板吗？

可能有人会说，自动化构建的好处众人皆知，可以省下无数重复工作；模板的好处显而易见，手写HTML是一件多么痛苦的事情。这些观点当然是正确的，但我们在这里讨论的是使用工具的必要性而不是自动化构建的必要性。在决定是否使用某一类工具时，我们应当仔细思考使用这类工具的必要性，而不能因为别人都使用了我们就使用。此外，各种工具的功能有一部分是重合的，比如工具A有功能1、2、3，工具B有功能3、4、5，很多时候可能我们仅仅需要的是功能2和3，那工具B就完全没有必要加入到我们的依赖列表里了。

这么说看起来有点太浅显，谁都知道刚才说的那种情况没有必要使用工具B，那就用一个真实的例子来说明吧。比如我们想要开发一个纯前端的项目，我们暂时只知道后端负责提供数据，至于后端用什么语言开发，API什么样，数据格式什么样暂时都还不清楚。我们手里有的资料暂时只有设计师给出的网站样式，以及产品经理给出的交互需求。假设我们想要React+Redux作为主要框架来实现，那构建工具我们到底需要那些呢？

面对这样的情况，一部分人可能直接上Github找一个模板或者Yeoman上找一个合适的Generator然后以此为起点就开始了。但我建议在这么做之前最好先仔细思考一下我们到底需要哪些工具，不需要哪些工具，然后再按照思考的结果找模板或者自己从头配置一个。

首先，对于这样的一个项目，写CSS是少不了的了，那选用一款自己顺手的CSS预处理语言必不可少，我喜欢Stylus，所以这毫无疑问是我的依赖项目之一；既然已经决定了用React+Redux，那一定涉及到大量JavaScript（JSX）的编写，那用Babel让源代码更简单易懂应该没有什么问题；想到这里，自然会考虑到在JS里各种静态资源的引用问题，Webpack正是解决这个问题的最佳方案；此外，开发过程中为了让代码更规范，有必要选用ESLint监督自己。

开发过程需要的工具差不多就是这些了，接下来思考一下测试需要用到的东西吧。测试框架有很多，当然选用一款即可。Jest测试React+Redux算是官方推荐，在这里我们也使用它。

测试完了就该考虑发布的事情了，既然后端什么样还不知道，我们做一个完全由客户端渲染的应用就好了。之前我们已经决定使用Webpack打包各种资源，那发布的东西应该就是打包好的JavaScript，CSS和图片什么的都应该在包里了。唯一额外的工作就是写一个简单的HTML作为整个应用的入口，等后端确定后,把这个HTML和后端的关系弄清楚，其他部分不必做太大改动。

对于每一步需要什么我们已经有了大致的印象，接下来我们要考虑需要哪些工具来自动化这些流程。首先想到的是我们需要在发布前自动测试，嗯……那用Gulp就好了……吗？

有人会说当然啦，发布前自动测试，这就是Gulp再也经典不过的应用场景了。可是如果再仔细想一想的话，如果我们使用Gulp，那当我们想要发布的时候，我们在Console里敲`gulp deploy`，Gulp就会自动为我们测试然后把编译好的JavaScript放到发布文件夹里，这自然很轻松。但如果我们不使用Gulp，我们同样可以写一个script，然后在Console里敲`npm deploy`，我们同样可以实现自动测试然后把编译好的JavaScript放到发布文件夹里。也就是说使用Gulp实际上并没有简化我们的工作流程，而却让我们多了一个依赖。这里的主要问题是：我们所做的是一个完全前端的项目，生产出浏览器可以运行的JavaScript是我们的唯一目的，在这种情况下，使用Gulp并没有为我们带来太大的便利，因为我们的目的太单一了。在全栈项目里，Gulp才可以发挥出最大的威力，因为有时候我们需要运行一个服务器来看网站的功能是否正常，有时我们需要发布客户端文件，有时我们需要编译服务器端文件。在这种情况下，如果我们手写各种script，任务之间的依赖关系就需要我们自己来掌握，这会成为额外的负担，所以才有使用Gulp的必要性。

这里没有提到“watch”的这个功能，因为Webpack本身已经提供了监视文件变动的功能，在这一点上二者是重合的。因此，为了“watch”而使用Gulp是完全没有必要的。但事实上，在Github上我也的确见到过几个前端项目为了watch而使用Gulp的。此时再回顾一下我刚才说的“工具A和工具B”，可能也就没有那么简单了吧。

最后，我们还应该注意到在整个流程中我们都没有使用到任何模板语言，比如pug或者EJS。因为对于React项目来说整个App是基于Virtual DOM而实现的，HTML的书写都集成在JSX里面了，开发者本身并不需要创建额外的HTML文件（除了作为整个应用的入口的占位HTML），所以模板语言并无必要。当然，如果连JSX里面的HTML也不想写，也有一些库提供了pug到JSX的方法。

一个基于React的前端项目不需要模板语言，不需要自动化构建工具，这可能会有一点出乎意料，但这正显示出了开发之前思考的意义，上面给出的例子也不代表所有情况。针对不同的实际情况，我们所需要的工具都是不一样的，Github上的项目为了保证其通用性大多包含了多于必需的依赖。但在实际开发中这种多于必需往往会造成混乱（或者会造成强迫症不爽），具体情况具体分析才是最重要的。
